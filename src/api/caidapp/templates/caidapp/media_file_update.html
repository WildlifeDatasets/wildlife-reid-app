{% extends 'base.html' %}
{% load custom_filters %}

{% block body %}
    {#<div class="container">#}
    {% if user.is_authenticated %}
        <div class="pagetitle">
            <div style="display: flex; justify-content: space-between">

                <div>
                    <h1>{{ headline }}</h1>
                    <nav>
                        <ol class="breadcrumb">
                            {% if mediafile.parent.contains_single_taxon %}
                                <li class="breadcrumb-item"><a href="{% url 'caidapp:uploads_identities' %}">Identities Uploads </a></li>
                            {% else %}
                                <li class="breadcrumb-item"><a href="{% url 'caidapp:uploads' %}"> Taxon Uploads</a></li>
                            {%  endif %}
                            <li class="breadcrumb-item"><a href="{% url 'caidapp:uploadedarchive_mediafiles' mediafile.parent.id %}"> Uploaded
                                Archive: {{ mediafile.parent }}</a></li>
                        </ol>
                    </nav>
                </div>
                <div>

                    <div class="dropdown mt-3">
                        {#                                <div class="dropdown d-inline-block">#}
                        <a class="btn btn-secondary dropdown-toggle" href="#" role="button"
                           data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-three-dots"></i>
                        </a>

                        <ul class="dropdown-menu">
                            {% if request.user.is_staff %}

                                <li>
                                    <a class="dropdown-item"
                                       href="{% url 'admin:caidapp_mediafile_change' mediafile.id %}">
                                        <i class="bi bi-lock"></i>
                                        Edit in admin
                                    </a>
                                </li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                            {% endif %}
                            <li>

                                {#                                            download mediafile#}
                                <a class="dropdown-item"
                                   href="{{ mediafile.mediafile.url }}" download>
                                    <i class="bi bi-download"></i> Download mediafile
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item text-danger"
                                   href="{% url 'caidapp:delete_mediafile' mediafile.id %}"
                                   onclick="return confirm('Delete file {{ mediafile }}?')">
                                    <i class="bi bi-trash"></i> Delete
                                </a>

                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div><!-- End Page Title -->
{#        {% if  mediafile.sequence.mediafile_set.all  > 1 %}#}
               <div class="d-flex flex-row flex-wrap m-1" style="width:auto;">

                    {% for sequence_mediafile in mediafile.sequence.mediafile_set.all %}
                        <a href="{% url 'caidapp:media_file_update' sequence_mediafile.id %}" class="m-1">
                            <img src="{{ sequence_mediafile.thumbnail.url }}" class="img-fluid" alt="Camera trap image" style="max-width: 100px;">
                        </a>
                    {% endfor %}

                </div>

{#        {% endif %}#}
        <div class="section">
            <div class="row">
{#                <div class="col-lg-4 col-xl-2">#}
                <div class="col-auto">
                    <div class="card">
                        {#                <div class="card-header">#}
                        {#                </div>#}
                        <div class="card-body">
                            <div style="display: flex; justify-content: space-between">
                                <form method="post" enctype="multipart/form-data" class="mt-3">
                                    {% csrf_token %}
{#                                    {{ form }}#}
{#                                                    {{ form.as_p }}#}
                                    <div class="form-group">
                                        {% if mediafile.is_for_suggestion %}
                                            <div>
                                                <i class="bi bi-question-circle"></i>
                                                Is it {{ mediafile.predicted_taxon  }} ({{ mediafile.predicted_taxon_confidence|mul:100|floor|floatformat:0 }}%) ?
                                                <button name="confirmTaxonSubmit" class="btn btn-primary" id="confirmTaxonSubmit" type="submit">
                                                    Confirm
                                                </button>
                                            </div>
                                        {% endif %}
        {% for field in form %}
            <div>
                    <label for="{{ field.id_for_label }}" class="mt-1">{{ field.label }}</label><br>  <!-- Label on its own line -->
                        {{ field }}  <!-- Field on the next line -->
                {% if field.help_text %}
                    <small class="form-text text-muted">{{ field.help_text }}</small>
                {% endif %}
                {% for error in field.errors %}
                    <div class="alert alert-danger" id="error_{{  field.id_for_label }}">{{ error }}</div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>



                                    <button class="btn btn-primary" id="btnUpload" type="submit">
                                        {{ button }}
                                    </button>
                                    {% if  skip_url %}
                                        <a href="{{ skip_url }}" class="btn btn-secondary mt-1 ">Skip</a>
                                    {% endif %}
                                    {% if  cancel_url %}
                                        <a href="{{ cancel_url }}" class="btn btn-secondary mt-1 ">Cancel</a>
                                    {% endif %}



                                </form>



                            </div>
                        </div>
                    </div>
                </div>
{#                <div class="col-lg-8 col-xl-10">#}
                    <div class="col">
            {% if mediafile.media_type == 'video' %}
                <video controls width="640" height="360">
{#                    <source src="{% url 'caidapp:stream_video' mediafile.id %}" type="video/mp4">#}
                    <source src="{% url 'caidapp:stream_video' mediafile.id %}" type="video/x-m4v">
                    Your browser does not support the video tag.
                </video>

                <img src="{{ mediafile.thumbnail.url }}" class="img-fluid" alt="Camera trap image">


            {% else %}
                <img src="{{ mediafile.preview.url }}" class="img-fluid" alt="Camera trap image">
            {% endif  %}
                </div>
            </div>
        </div>
    {% endif %}
    {#</div>#}
{% endblock %}