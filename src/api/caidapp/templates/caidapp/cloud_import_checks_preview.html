{% extends 'base.html' %}
{% load static %}
{% block head %}
    <!--refresh every 120 s-->
    {#<meta http-equiv="refresh" content="120">#}
{% endblock %}
{% block body %}
    {% if user.is_authenticated %}
        <div class="pagetitle">
            <h1>Cloud import</h1>
{#            <nav>#}
{#                <ol class="breadcrumb">#}
{#                    <li class="breadcrumb-item"><a href="{% url 'caidapp:uploads' %}">Uploads</a></li>#}
{#                </ol>#}
{#                {%  if user.caiduser.import_dir|length > 0 %}#}
{#                    <a class="btn btn-secondary" href="{% url 'caidapp:upload_archive' %}"#}
{#                    data-bs-toggle="tooltip" title="Location: "#}
{#                    ><i class="bi bi-cloud-arrow-up"></i> Import from cloud</a>#}
{#                {% endif %}#}
{##}
{##}
{#                <a class="btn {{ btn_styles.upload_species }}" href="{% url 'caidapp:upload_archive' %}"><i class="bi bi-plus-circle"></i> New Upload </a>#}
{#                <i class="bi bi-arrow-right-short fa-2x" style="vertical-align: middle;"></i>#}
{#                <a class="btn {{ btn_styles.classify_non_classified }}" href="{% url 'caidapp:missing_taxon_annotation' %}"#}
{#                   data-bs-toggle="tooltip" title="{{ btn_tooltips.classify_non_classified }}"#}
{#                >Classify non classified</a>#}
{#            </nav>#}
        </div><!-- End Page Title -->
        <section class="section">
            {#            <ul class="container">#}
            <div class="row">

                {% if page_obj %}
                    {% for uploadedarchive in page_obj %}
                        <div class="col-xl-3">
{#                        <div class="col" style="-ms-flex: 0 0 200; flex: 0 0 200;">#}
                            <div class="card {% if uploadedarchive.error_message %} bg-danger-light {% elif not uploadedarchive.location_exists  or uploadedarchive.zip_name_exists %} bg-warning-light {% endif %}"
                            >
                                <div class="card-body"
                                >

                                    <h5 class="card-title" >
                                        {{ uploadedarchive.path }}


{#                                        {% if uploadedarchive.contains_identities %}#}
{#                                            <i class="bi bi-fingerprint"></i>#}
{#                                        {% endif %}#}
{#                                        {% if uploadedarchive.contains_single_taxon %}#}
{#                                            <i class="bi bi-dice-1"></i>#}
{#                                        {% endif %}#}
{##}
                                    </h5>
                                    {% if uploadedarchive.error_message %}
                                        {{ uploadedarchive.error_message }}
                                    {% else %}
                                        <p class="card-text">
                                        Locality: <strong>{{ uploadedarchive.location }}</strong>
                                        </p>
                                        {%  if not uploadedarchive.location_exists %}
                                            <p class="card-text">
                                                <span class="text text-warning">New locality</span>: <br>
                                                Is this really a first use of the locality or is it a typo?
                                            </p>
                                        {% endif %}

                                        <p class="card-text">
                                            Check date: <strong>{{ uploadedarchive.date }}</strong>
                                        </p>
                                        <p class="card-text mt-2">
                                            Zip file <span class="font-monospace">{{ uploadedarchive.zip_name }}</span> is ready to be imported into application.
                                        </p>

                                        {%  if uploadedarchive.zip_name_exists %}
                                            <span class="text text-warning"> ZIP-file already exists.</span>: You can ignore this warning.<br>
                                        {% endif %}

                                    {% endif %}
{##}
{#                                    {{ uploadedarchive.zip_name }} <br>#}
{#                                    <p>Location: <span data-bs-toggle="tooltip" title="Location: {{ uploadedarchive.location_at_upload_object.name }}">{{ uploadedarchive.location_at_upload_object.visible_name }}</span></p>#}
{#                                    {{ uploadedarchive.path }} <br>#}
{#                                    <p>{{ uploadedarchive.starts_at|date:'Y-m-d' }} - {{ uploadedarchive.ends_at|date:'Y-m-d' }} </p>#}
                                </div>
                            </div>
                        </div>

                    {% endfor %}


                    <ul class="pagination mt-2">
                        {#                            <span class="step-links">#}
                        {% if page_obj.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page=1">First </a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}">
                                    <i class="bi-chevron-left"></i>
                                </a>
                            </li>
                        {% else %}
                            <li class="page-item disabled">
                                <a class="page-link" href="#">First</a>
                            </li>
                            <li class="page-item disabled">
                                <a class="page-link" href="#">
                                    <i class="bi-chevron-left"></i>
                                </a>
                            </li>
                        {% endif %}

                        <li class="page-item">
                            {#                                <span class="current">#}
                            <a class="page-link" href="#">
                                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                            </a>
                            {#                                </span>#}
                        </li>

                        {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}">
                                    <i class="bi-chevron-right"></i>
                                </a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Last</a>
                            </li>

                        {% else %}
                            <li class="page-item disabled">
                                <a class="page-link" href="#">
                                    <i class="bi-chevron-right"></i>
                                </a>
                            </li>
                            <li class="page-item disabled">
                                <a class="page-link" href="#">
                                    Last
                                    {#                                            <i class="bi-chevron-bar-right"></i>#}
                                </a>
                            </li>
                        {% endif %}
                        {#                            </span>#}
                    </ul>

                    <div class="container">
                        <div class="btn-group" role="group" aria-label="Basic example">


                            <a class="btn btn-primary mt-3 {% if user.caiduser.dir_import_status == 'Processing' %} disabled {% endif %}"
                               href="{% url 'caidapp:do_cloud_import' %}">Import all
                                {% if user.caiduser.dir_import_status == 'Processing' %}
                                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                {% endif %}
                            </a>
                            {% if user.caiduser.dir_import_status == 'Processing' %}
                                <a class="btn btn-warning mt-3"
                                   href="{% url 'caidapp:break_cloud_import' %}"><i class="bi bi-stop-fill"></i>

                                </a>

                            {% endif %}
                        </div>

                    </div>


                {% else %}
                    <p>No data available.</p>
                {% endif %}


            </div>
            {#            </ul>#}
            </div>
            <div>
                <h3>Client Setup</h3>
                <ol>
                    <li>Ask CaID administrator for Synology address, login and password</li>
                    <li>Download and install <a href="https://www.synology.com/en-us/dsm/feature/drive">Synology Drive Client</a> </li>
                    <li>Connect the Drive Client to remote dir <code>{{ text }}</code></li>
                    <li>Your local dir might be  named like this: <code> {HOME}/caid_import </code></li>
                </ol>

                <h3> Client Workflow</h3>
<ol>
                    <li>In your local synchronized dir (<code>{HOME}/caid_import</code>) prepare a structure based on locality name and locality check date. There are two options:
                        <ul>
                            <li>Directory or zip-file in format: <code>{YYYY}-{MM}-{DD}_{LOCATION NAME}</code></li>
                            <li>Directory named by date with one or more subdirectories named by location: <code>{YYYY}-{MM}-{DD} / {LOCATION NAME}</code></li>
                        </ul>

                    </li>
                    <li>Check the status of the import on the <a href="{%  url 'caidapp:cloud_import_preview' %}">CarnivoreID website</a></li>
                    <li>After the import is done, the dir or zip-file will be moved from the synchronized dir to <code>{HOME}/caid_import/_imported</code>. It might be deleted by you</li>
</ol>
            </div>
        </section>
    {% endif %}
{% endblock %}
