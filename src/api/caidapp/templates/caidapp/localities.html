{% extends 'base.html' %}
{% load static %}
{% block head %}
    <style>
        /* Custom breakpoint for screens larger than 1920px (you can adjust the value as needed) */
        @media (min-width: 1920px) {
            .col-xxxl-1 {
                flex: 0 0 auto;
                width: 8.33%; /* 1/12th of the width */
            }
            .col-xxxl-2 {
                flex: 0 0 auto;
                width: 16.66%; /* 2/12th of the width */
            }
            .col-xxxl-3 {
                flex: 0 0 auto;
                width: 25%; /* 3/12th of the width */
            }
            .col-xxxl-4 {
                flex: 0 0 auto;
                width: 33.33%; /* 4/12th of the width */
            }
            .col-xxxl-6 {
                flex: 0 0 auto;
                width: 50%; /* 6/12th of the width */
            }
        }



        .card {
            display: flex;
            flex-direction: column;
        }

        .card-body {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .image-container-300 {
            width: 300px;
            height: 225px;
        }

        .image-container-300 img {
            width: 300px;
            height: 225px;
            object-fit: cover;
        }

        .card.width-300 {
            width: 300px;
        }
    </style>
{% endblock %}
{% block body %}
    {% if user.is_authenticated %}


        <div class="pagetitle">
            <h1>Localities</h1>
        <nav>
            <a href="{% url 'caidapp:update_locality' %}" class="btn btn-secondary">
                <i class="fas fa-plus"></i> Add new locality
            </a>
            <a href="{% url 'caidapp:suggest_merge_localities' %}" class="btn btn-secondary">
                <i class="bi bi-union"></i> Suggest merge localities
            </a>
            <a href="{% url 'caidapp:import_localities' %}" class="btn btn-secondary">
                <i class="fas fa-file-import"></i> Import spreadsheet
            </a>
            <a href="{% url 'caidapp:export_localities' %}" class="btn btn-secondary">
                <i class="fas fa-file-export"></i> Export CSV
            </a>
            <a href="{% url 'caidapp:export_localities_xls' %}" class="btn btn-secondary">
                <i class="fas fa-file-excel"></i>
                Export XLSX
            </a>

            <a href="{% url 'caidapp:pygwalker_localities' %}" class="btn btn-secondary">
{#                graphs and statistics #}
                <i class="fas fa-chart-line"></i> Walk Localities
            </a>
        </nav>

        </div><!-- End Page Title -->
        <section class="section">
        {% include "caidapp/filter_collapse.html" %}
{#        <form method="GET" action="{% url 'caidapp:localities' %}">#}
{#             <div style="display: flex; align-items: center;">#}
{#                {% for field in filter_form %}#}
{#                  <div style="margin-right: 15px;">#}
{#                    {{ field.label_tag }} {{ field }}#}
{#                  </div>#}
{#                {% endfor %}#}
{#                <input type="submit" value="Filter" class="btn btn-primary">#}
{#              </div>#}
{#        </form>#}
        <div class="d-flex justify-content-between mt-3">
            <div>
                {% include 'caidapp/pagination_simple_a.html' %}
            </div>
            <div>
                {% with name_plural='localities' %}
                    {% include 'caidapp/localities_order_by.html' %}
                {% endwith %}


            </div>

        </div>
{#        {{ localities|length }} localities#}
{#        {{ page_obj.paginator.count }} localities#}
        <div class="row" id="row-of-cards">

            {% if localities %}
                {% for locality in localities %}
                    <div class="col-auto" id="card{{ locality.id }}">
                        <div class="card width-300">
                            <div class="image-container-300">
                            {% if locality.mediafile_set.count > 0 and locality.mediafile_set.all.0.image_file  %}
                                    <a href="{% url 'caidapp:update_locality' locality.id %}" class=""
                                            {%  if request.session.private_mode %}
                                       onclick="return confirm('You are in private mode. In edit view you will reveal the locality. Do you want to continue?')"
                                            {% endif %}
                                    >
                                    <img
                                            class="card-img-top"
{#                                            src="{{ locality.uploadedarchive_set.all.0.thumbnail.url }}"#}
{#                                            src="{{ locality.mediafiles.all.0.image_file.url }}"#}
                                            src="{{ locality.mediafile_set.all.0.get_static_thumbnail.url }}"
                                            alt="Camera trap image"
                                    >
                                    </a>
                            {% else %}
                                <div class="card-img-top placeholder" style="width: 300px; height: 225px; background-color: #898c8f;"></div>
                            {% endif %}
                            </div>

                            <div class="card-body">
                                <h5 class="card-title">
                                <a href="{% url 'caidapp:update_locality' locality.id %}" class=""
                                        {%  if request.session.private_mode %}
                                   onclick="return confirm('You are in private mode. In edit view you will reveal the locality. Do you want to continue?')"
                                        {% endif %}
                                >
                                    {%  if request.session.private_mode %}
                                        {{ locality.visible_name }}
                                    {% else %}
                                        {{ locality.name }}
                                    {% endif %}
                                    {% if locality.location %}
                                        <i class="fas fa-map-marker-alt" data-bs-toggle="tooltip" title="The GPS location is set"></i>
                                    {% endif %}

                                </a>

                                </h5>
                             {% if locality.area %}
    <h6 class="card-subtitle mb-2 text-muted">{{ locality.area }}</h6>
  {% endif %}
                                <p class="card-text">

                                    <a href="{% url 'caidapp:uploads_of_locality' locality.hash %}" class="link-secondary"
                                       data-bs-toggle="tooltip" title="Camera Trap Checks"
                                    >
                                        <i class="fas fa-camera"></i>
                                    Camera trap checks: {{ locality.uploadedarchive_set.count }}
                                    </a>
                                    <br>
                                    <a href="{% url 'caidapp:media_files_locality' locality.hash %}" class="link-secondary" >
                                        <i class="fas fa-images"></i> Media files: {{ locality.mediafile_count }}
                                    </a>

                                </p>
                            </div>
                            <div class="card-footer">
                                <a href="{% url 'caidapp:update_locality' locality.id %}" class="btn btn-secondary"
                                        {%  if request.session.private_mode %}
                                            onclick="return confirm('You are in private mode. In edit view you will reveal the locality. Do you want to continue?')"
                                        {% endif %}
                                >
                                    <i class="fas fa-edit"></i> Edit
                                    </a>
{#                                <a href="{% url 'caidapp:media_files_locality' locality.hash %}" class="btn btn-secondary" >#}
{#                                    <i class="fas fa-images"></i> Media files#}
{#                                </a>#}
{#                                <a href="{% url 'caidapp:uploads_of_locality' locality.hash %}" class="btn btn-secondary"#}
{#                                   data-bs-toggle="tooltip" title="Camera Trap Checks"#}
{#                                >#}
{#                                    <i class="fas fa-images"></i> Media files#}
{#                                    Checks#}
{#                                </a>#}

{#                                <div class="position-absolute bottom-0 end-0 p-3">#}
                                    {#                                        info in circle#}
{##}
{#                                    <span#}
{#                                            data-bs-toggle="tooltip"#}
{#                                            data-toggle="tooltip"#}
{#                                            title="ahoj"#}
{#                                    >#}
{#                                            <i class="bi bi-info-circle"></i>#}
{#                                        </span>#}
{##}
{#                                </div>#}
                            </div>

{#                            {{ locality.uploadedarchive_set.all.0.thumbnail.url }}#}
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
        </section>

    {% endif %}
{% endblock %}